{% extends 'base.html' %}
{% load tags %}
{% load staticfiles %}

{% block content %}

<div class="container">
    <div class="row">

        <div class="col-xs-4">
            <div class="dropdown">
                <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Select Curriculum
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    <li><a href="#">Curr_17-18</a></li>
                    <li><a href="#">Test_Curr</a></li>
                    <li><a href="#">Curr_18-19</a></li>
                </ul>
            </div>
        </div>

        <div class="col-xs-4">
            <div class="dropdown">
                <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Select Outcomes
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    <li><a href="#">USMLE</a></li>
                    <li><a href="#">School ABOs</a></li>
                </ul>
            </div>
        </div>

        <div class="col-xs-4">
            <div class="dropdown">
                <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Other Parameters
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    <li><a href="#">X</a></li>
                    <li><a href="#">Y</a></li>
                    <li><a href="#">Z</a></li>
                </ul>
            </div>
        </div>

</div>

<div class="form-group">
    <label for="run">Name the Run:</label>
    <input type="text" class="form-control" id="run">
</div>


<form id="form-group" action="" method="post">
  {% csrf_token %}
  <button type="submit" class="btn btn-primary btn-block" name="map" value="map">Map It</button>
  <div modal
</form>


<h4>Run Status</h4>

<h4>Run Complete
    <a href="#" class="btn btn-info btn" role="button">Reports</a>
    <a href="#" class="btn btn-info btn" role="button">Analysis</a>
</h4>

<h4>Run Failed</h4>
<p>Error 000N: Get some <a href="#" class="btn btn-info btn" role="button">Help</a></p>

<form></form>
<form method="post" class="needs-validation" enctype="multipart/form-data"  action="/push_run_script" id="fupload">
    {% csrf_token %}
    <div class="input-group">
        <input type="file" class="form-control" name="data_file" id="my_file" required>
        <span class="input-group-btn">
            <button type="submit" class="btn btn-info">Upload files</button>
        </span>
    </div>
</form>


<!-- get run data -->
<form action="run_modal" method="post">
  {% csrf_token %}
  <button type="submit" class="btn btn-primary">Popup</button>
</form>

<!-- run modal -->
<div class="modal fade main-modal" tabindex="-1" id="run_modal" >
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Run</h4>
            </div>
            <div style=" height: 750px; overflow-y: scroll;">
                <table class="table table-bordered table-sm" style="table-layout: fixed; width: 100%">
                    <thead>
                        <tr>
                            <th>Event Name</th>
                            <th>Coverage Name</th>
                            <th>Coverage Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in run1 %}
                            <tr >
                                <td style="word-wrap: break-word">{{entry.event_name}}</td>
                                <td>{{entry.coverage_name}}</td>
                                <td>{{entry.score}}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!--  block scripts -->
{% if modal %}
    <script type="text/javascript">
        $(document).ready(function(){
            $("#run_modal").modal('show');
        });
    </script>

    {% update_variable False as modal %}
{% endif %}


<script type="text/javascript">
var frm = $('#fupload');
frm.submit(function () {
    event.preventDefefault(); // No reload, just send data
    var file =  new FormData(frm.get(0));
    $.ajax({
        type: frm.attr('method'),
        url: frm.attr('action'),
        data: file,
        processData: false,
        contentType: false,
        success: function (data) {
            alert('Run was sent to your postgres db');
        },
        error: function(data) {
            alert('Oops, there was an error');
        }
    });
    return false;
});
</script>

{% endblock %}
